// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

model AppSettings {
  id                       String   @id @default(uuid())
  shop                     String   @unique
  amazonAffiliateId        String?
  affiliateModeEnabled     Boolean  @default(false)
  buttonText               String   @default("Buy on Amazon")
  buttonEnabled            Boolean  @default(true)
  buttonPosition           String   @default("AFTER_BUY_NOW") // AFTER_BUY_NOW or BEFORE_BUY_NOW
  pricingMode              String   @default("MULTIPLIER") // MULTIPLIER or FIXED
  pricingValue             Float    @default(1.0)
  defaultImportMode        String   @default("DROPSHIPPING") // AFFILIATE or DROPSHIPPING
  defaultCollectionId      String?  // Default collection to add products to
  autoPublish              Boolean  @default(false) // Auto-publish imported products
  termsAccepted            Boolean  @default(false)
  termsAcceptedAt          DateTime?

  // Billing fields
  currentPlan              String   @default("FREE") // FREE, BASIC, PRO, PREMIUM
  subscriptionId           String?  // Shopify subscription ID
  subscriptionStatus       String?  // ACTIVE, CANCELLED, EXPIRED
  planStartDate            DateTime?
  planEndDate              DateTime?

  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
}

model ImportedProduct {
  id                String   @id @default(uuid())
  shop              String
  shopifyProductId  String
  shopifyHandle     String?  // Product handle for easy linking
  shopifyVariantId  String?
  amazonUrl         String
  amazonAsin        String?
  title             String
  description       String?
  price             Float    // Final price in Shopify
  originalPrice     Float    // Original Amazon price
  markup            Float?   // Markup applied (value or percentage)
  markupType        String?  // FIXED or PERCENTAGE
  importMode        String   @default("DROPSHIPPING") // AFFILIATE or DROPSHIPPING
  productImage      String?  // Main product image URL
  images            String?  // JSON array of all image URLs
  variantCount      Int      @default(1)
  status            String   @default("DRAFT") // DRAFT or ACTIVE
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([shop])
  @@index([shopifyProductId])
  @@index([createdAt])
  @@index([importMode])
}
